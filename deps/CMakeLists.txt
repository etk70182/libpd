set(LOCAL_PTHREADS_INCLUDE_DIR ${CMAKE_CURRENT_BINARY_DIR}/Pre-built.2/include)

set(LOCAL_PTHREADS_HEADERS
  ${LOCAL_PTHREADS_INCLUDE_DIR}/pthread.h
  ${LOCAL_PTHREADS_INCLUDE_DIR}/sched.h
  ${LOCAL_PTHREADS_INCLUDE_DIR}/semaphore.h
  )

set(LOCAL_PTHREADS_LIBS
  ${CMAKE_CURRENT_BINARY_DIR}/Pre-built.2/lib/x64/pthreadVC2.lib
  )

set(LOCAL_PTHREADS_FILES
  ${LOCAL_PTHREADS_HEADERS}
  ${LOCAL_PTHREADS_LIBS}
  )


add_custom_target(local_pthreads
  WORKING_DIRECTORY
    ${CMAKE_CURRENT_BINARY_DIR}
  DEPENDS
    ${LOCAL_PTHREADS_FILES}
  COMMENT
    "Intermediate pthread target"
  VERBATIM
  )

add_custom_command(
  OUTPUT
    ${LOCAL_PTHREADS_FILES}
  COMMAND
    ${CMAKE_COMMAND} -E tar xzf ${CMAKE_CURRENT_SOURCE_DIR}/pthreads-w32-2-9-1-release.zip
  WORKING_DIRECTORY
    ${CMAKE_CURRENT_BINARY_DIR}
  DEPENDS
    ${CMAKE_CURRENT_SOURCE_DIR}/pthreads-w32-2-9-1-release.zip
  COMMENT
    "Unpacking pre-built pthread libraries"
  )

set(CMAKE_THREAD_LIBS_INIT ${LOCAL_PTHREADS_LIBS} PARENT_SCOPE)
set(PTHREADS_INCLUDE_DIR ${LOCAL_PTHREADS_INCLUDE_DIR} PARENT_SCOPE)
